<!DOCTYPE html>
<html>
  <head>
    <title>自定义组件</title>
    <script src="../vue.js"></script>
  </head>

  <body>
    <!-- 自定义组件 -->
    <div id="app">
      <!-- 表单输入绑定 -->
      <input v-model="course" type="text" v-on:keydown.enter="addCourse" />
      <!-- 事件处理 -->
      <button v-on:click="addCourse">新增课程</button>
      <course-list :courses="courses"></course-list>
      <!-- 自定义组件支持v-model需要实现内部input的:value和@input -->
      <course-add v-model="course" @add-course="addCourse"></course-add>
    </div>
    <script>
      // 组件注册
      Vue.component('course-add', {
        // 接收父组件传递value，不需要额外维护course
        props: ['value'],
        template: ` <div><!-- 需要实现input的:value和@input --> <input :value="value" @input="onInput" @keydown.enter="addCourse"/> <button v-on:click="addCourse">新增课程</button> </div> `,
        methods: {
          addCourse() {
            // 派发事件不再需要传递数据
            this.$emit('add-course'); // this.course = ''
          },
          onInput(e) {
            this.$emit('input', e.target.value);
          },
        },
      });
      // 注册course-list组件
      Vue.component('course-list', {
        data() {
          return {
            // 改状态属于course-list内部状态，因此作为数据
            selectedCourse: '',
          };
        },
        props: {
          // 新增课程时也要访问courses，因此作为属性传递
          courses: { type: Array, default: [] },
        },
        template: `<div><!-- 条件渲染 --> <p v-if="courses.length == 0">没有任何课程信息</p> <!-- 列表渲染 --> <ul><!-- class绑定 --> <li v-for="c in courses" :class="{active: (selectedCourse === c)}" @click="selectedCourse = c">{{c}}</li> <!-- style绑定 --> <!-- <li v-for="c in courses" :style="{backgroundColor: (selectedCourse === c)?'#ddd':'transparent'}" @click="selectedCourse = c">{{c}}</li> --> </ul> </div> `,
      });
      const app = new Vue({
        el: '#app',
        data: { title: '开课吧购物车', courses: ['web全栈', 'web高级'], course: '' },
        methods: {
          addCourse() {
            this.courses.push(this.course);
            this.course = '';
          },
        },
      });
    </script>
  </body>
</html>
